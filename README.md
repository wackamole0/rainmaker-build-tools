# Rainmaker

## Requirements

 - Vagrant 1.6.2

 - Virtualbox 4.3

## Installation

1. Download and install Vagrant

2. Download and install Virtualbox

3. Download and Rainmaker Vagrant box and import into Vagrant

## Configuration

Create the file /etc/resolver/localdev with the following content: nameserver 10.100.0.2

## Usage

### Starting Rainmaker for the first time

1. Create a new directory

2. Navigate into new directory

3. Copy the Vagrantfile from the root of the Rainmaker repo to new directory

4. vagrant up

### Starting Rainmaker (subsequent starts after the first)

vagrant up

### Stopping Rainmaker

vagrant suspend

### Creating a New Project Container

1. Connect via shell to Rainmaker's Virtualbox VM

2. Execute from the shell: sudo lxc-clone _golden-proj_ myproject

3. Move the container config out the way for now

4. Copy the container config for _golden-proj_ in place to myproject

5. Extract the lxc.utsname value from the myproject container config generated by the cloning and set it in the myproject container config

6. Extract the lxc.network.hwaddr value from the myproject container config generated by the cloning and set it in the myproject container config

7. Remove the container config for the myproject container created by the clone

8. Set the container's hostname in /var/lib/lxc/myproject/rootfs/etc/hostname

9. Set the container's hostname to resolve to 127.0.1.1 in /var/lib/lxc/myproject/rootfs/etc/hosts

10. Connect via shell to Rainmaker's services container

11. Navigate to /etc/dhcp

12. Edit dhcpd.subnet.conf.d/10.100.0.0.conf as necessary

13. Copy dhcpd.host.conf.d/localdev.example.cluster.conf to dhcpd.host.conf.d/localdev.myproject.cluster.conf

14. Edit dhcpd.host.conf.d/localdev.myproject.cluster.conf as necessary

15. Add the following line to the file dhcpd.host.conf: include "include "/etc/dhcp/dhcpd.host.conf.d/localdev.myproject.cluster.conf";

16. Copy dhcpd.class.conf.d/localdev.example.conf to dhcpd.class.conf.d/localdev.myproject.conf

17. Edit dhcpd.class.conf.d/localdev.myproject.conf as necessary

18. Add the following line to the file dhcpd.class.conf: include "include "/etc/dhcp/dhcpd.class.conf.d/localdev.myproject.conf";

19. Restart the DHCP service: service isc-dhcp-server restart

20. Navigate to /etc/bind

21. Copy db.rainmaker/db.example.localdev to db.rainmaker/db.myproject.localdev

22. Edit db.rainmaker/db.myproject.localdev as necessary

23. Copy db.rainmaker/db.10.100.1.example to db.rainmaker/db.10.100.1

25. Edit db.rainmaker/db.10.100.1 as necessary

26. Copy named.conf.rainmaker/example.conf to named.conf.rainmaker/myproject.conf

27. Edit named.conf.rainmaker/myproject.conf as necessary

28. Add entry to named.conf.local to for named.conf.rainmaker/myproject.conf

29. Restart the DNS service: service bind9 restart

30. Start new container

### Creating a New Project Branch Container

1. Connect via shell to the cluster management container for the project you wish to create a new branch for

2. Execute from the shell: sudo lxc-clone _golden-branch_ mynewbranch

3. Move the container config out the way for now

4. Copy the container config for _golden-branch_ in place to mynewbranch

5. Extract the lxc.utsname value from the mynewbranch container config generated by the cloning and set it in the mynewbranch container config

6. Extract the lxc.network.hwaddr value from the mynewbranch container config generated by the cloning and set it in the mynewbranch container config

7. Remove the container config for the mynewbranch container created by the clone

8. Set the container's hostname in /var/lib/lxc/mynewbranch/rootfs/etc/hostname

9. Set the container's hostname to resolve to 127.0.1.1 in /var/lib/lxc/mynewbranch/rootfs/etc/hosts

10. Connect via shell to Rainmaker's services container

11. Navigate to /etc/dhcp

12. Copy dhcpd.host.conf.d/localdev.example.conf to dhcpd.host.conf.d/localdev.myproject.mynewbranch.conf

13. Edit dhcpd.host.conf.d/localdev.myproject.mynewbranch.conf as necessary

14. Add the following line to the file dhcpd.host.conf: include "include "/etc/dhcp/dhcpd.host.conf.d/localdev.myproject.mynewbranch.conf";

15. Restart the DHCP service: service isc-dhcp-server restart

16. Navigate to /etc/bind

17. Copy db.rainmaker/db.example.localdev to db.rainmaker/db.myproject.localdev

18. Edit db.rainmaker/db.myproject.localdev as necessary

19. Copy db.rainmaker/db.10.100.1.example to db.rainmaker/db.10.100.1

20. Edit db.rainmaker/db.10.100.1 as necessary

21. Copy named.conf.rainmaker/example.conf to named.conf.rainmaker/myproject.conf

22. Edit named.conf.rainmaker/myproject.conf as necessary

23. Add entry to named.conf.local to for named.conf.rainmaker/myproject.conf

24. Restart the DNS service: service bind9 restart

25. Start new container

## Changelog

v0.1: Initial working infrastructure and Drupal container profile

